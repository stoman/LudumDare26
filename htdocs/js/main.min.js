function loadLevel(){var e=randomPosition(50);player=new Player(e.x,e.y,Math.random()*2*Math.PI,levels[currentLevel].playerSpeed,levels[currentLevel].playerAgility);enemies=[];highlights=[];passersby=[];keysPressed=[];currentFrame=0;frameRateStart=0;frameRate=0;framesNoEnemy=0;addEnemies(levels[currentLevel].initialEnemies,false);addPassersby(levels[currentLevel].initialPassersby,false);currentBackground=playBackgroundMusic(levels[currentLevel].backgroundIndex);draw()}function startGame(){if(readyToStart&&!won){hideInstructions();currentCronjobs.push(setInterval(draw,30));currentCronjobs.push(setInterval(update,30));currentCronjobs.push(setInterval(measureFrameRate,1e3));currentCronjobs.push(setInterval(refreshStats,1e3));readyToStart=false;$("#start-game").hide();$("#stop-game").show()}else if(won){restartGame()}}function stopGame(){for(var e=0;e<currentCronjobs.length;e++){clearInterval(currentCronjobs[e])}currentCronjobs=[];readyToStart=true;draw();$("#start-game").show();$("#stop-game").hide()}function nextLevel(){if(currentLevel<levels.length-1){currentBackground.pause();currentLevel++;loadLevel();refreshStats()}else{$("#game-won").show("slide",{direction:"up"},"slow");won=true;draw()}}function restartGame(){if(won){currentBackground.pause();$("#game-won").hide();stats={enemyHit:0,killsEnemy:0,killsPasserby:0,killsWall:0,passerbyHit:0,wallHit:0};currentLevel=0;won=false;loadLevel();refreshStats()}}function measureFrameRate(){frameRate=currentFrame-frameRateStart;frameRateStart=currentFrame}function draw(){currentFrame++;canvas.height=canvas.height;for(var e=0;e<levels[currentLevel].walls.length;e++){levels[currentLevel].walls[e].render()}for(var e=0;e<enemies.length;e++){enemies[e].render()}for(var e=0;e<passersby.length;e++){passersby[e].render()}player.render();for(var e=0;e<highlights.length;e++){highlights[e].render()}if(!won&&(currentFrame<=50||readyToStart)){context.font="60pt Calibri";context.textAlign="center";context.textBaseline="middle";context.lineWidth=3;context.strokeStyle=colors.headings;context.strokeText("Level "+(currentLevel+1),canvas.width/2,canvas.height/4);context.font="15pt Calibri";var t=levels[currentLevel].text.split(" ");var n="";var r=canvas.height*3/4-20;for(var e=0;e<t.length;e++){var i=context.measureText(n+" "+t[e]).width;if(i+40<canvas.width){n+=" "+t[e]}else{i=context.measureText(n).width;context.beginPath();context.rect(canvas.width/2-i/2,r-8,i,16);context.closePath();context.fillStyle=colors.background;context.fill();context.fillStyle=colors.headings;context.fillText(n,canvas.width/2,r);r+=20;n=t[e]}}var i=context.measureText(n).width;context.beginPath();context.rect(canvas.width/2-i/2,r-8,i,16);context.closePath();context.fillStyle=colors.background;context.fill();context.fillStyle=colors.headings;context.fillText(n,canvas.width/2,r);if(readyToStart){context.strokeStyle=colors.background;context.lineWidth=5;context.font="25pt Calibri";context.strokeText("Click to start or press the space key.",canvas.width/2,canvas.height/2);context.fillText("Click to start or press the space key.",canvas.width/2,canvas.height/2)}else if(currentFrame<=30){context.lineWidth=6;context.font="100pt Calibri";context.fillStyle=colors.background;context.strokeText("Ready?",canvas.width/2,canvas.height/2);context.fillText("Ready?",canvas.width/2,canvas.height/2)}else{context.lineWidth=7;context.font="140pt Calibri";context.fillStyle=colors.background;context.strokeText("Go!",canvas.width/2,canvas.height/2);context.fillText("Go!",canvas.width/2,canvas.height/2)}}if(debug){context.font="10pt Calibri";context.textAlign="left";context.textBaseline="top";context.fillStyle=colors.debug;context.fillText("fps: "+frameRate,20,20);context.fillText("keysPressed: ["+keysPressed+"]",20,30);context.fillText("enemies: "+enemies.length,20,40)}}function update(){if(currentFrame<=50){return}player.updatePosition();for(var e=0;e<enemies.length;e++){enemies[e].updatePosition()}for(var e=0;e<passersby.length;e++){passersby[e].updatePosition()}for(var e=0;e<enemies.length;e++){enemies[e].turnTowards(player)}if(-1!=$.inArray(39,keysPressed)||-1!=$.inArray(68,keysPressed)){player.turnRight()}if(-1!=$.inArray(37,keysPressed)||-1!=$.inArray(65,keysPressed)){player.turnLeft()}for(var e=enemies.length-1;e>=0;e--){if(enemies[e].collidesWith(player)){stats.enemyHit++;playSound("player_hit");enemies.splice(e,1);addEnemies(levels[currentLevel].penaltyEnemy,true)}}for(var e=0;e<levels[currentLevel].walls.length;e++){if(levels[currentLevel].walls[e].collidesWith(player)){stats.wallHit++;playSound("player_hit");highlights.push(new Explosion(player.x,player.y));addEnemies(levels[currentLevel].penaltyWall,true);player.angle+=Math.PI;player.updatePosition();player.angle=2*Math.PI*Math.random()}}for(var e=passersby.length-1;e>=0;e--){if(passersby[e].collidesWith(player)){stats.passerbyHit++;playSound("player_hit");highlights.push(new Explosion(player.x,player.y));addEnemies(levels[currentLevel].penaltyPasserby,true);passersby.splice(e,1)}}for(var e=0;e<levels[currentLevel].walls.length;e++){for(var t=0;t<passersby.length;t++){if(levels[currentLevel].walls[e].collidesWith(passersby[t])){passersby[t].angle+=Math.PI;passersby[t].updatePosition();passersby[t].angle=2*Math.PI*Math.random()}}}var n=[];for(var e=0;e<enemies.length;e++){for(var t=0;t<levels[currentLevel].walls.length;t++){if(levels[currentLevel].walls[t].collidesWith(enemies[e])){if(-1==$.inArray(e,n)){stats.killsWall++;n.push(e)}}}for(var t=0;t<passersby.length;t++){if(passersby[t].collidesWith(enemies[e])){if(-1==$.inArray(e,n)){stats.killsPasserby++;n.push(e)}}}for(var t=e+1;t<enemies.length;t++){if(enemies[e].collidesWith(enemies[t])){if(-1==$.inArray(e,n)){stats.killsEnemy++;n.push(e)}if(-1==$.inArray(t,n)){stats.killsEnemy++;n.push(t)}}}}if(n.length>0){playSound("enemy_kill");n.sort(function(e,t){return t-e});for(var e=0;e<n.length;e++){highlights.push(new Explosion(enemies[n[e]].x,enemies[n[e]].y));enemies.splice(n[e],1)}}for(var e=highlights.length-1;e>=0;e--){if(highlights[e].step==0){highlights.splice(e,1)}else{highlights[e].updatePosition()}}if(enemies.length==0){framesNoEnemy++}else{framesNoEnemy=0}if(framesNoEnemy>=levels[currentLevel].winFrames){stopGame();nextLevel()}}function hideInstructions(){$("#instructions").hide();$("#show-instructions").show();$("#hide-instructions").hide()}function showInstructions(){stopGame();$("#instructions").show();$("#show-instructions").hide();$("#hide-instructions").show()}function playSound(e){if(!muted){sounds[e][soundIndex[e]].play();soundIndex[e]=(soundIndex[e]+1)%sounds[e].length}}function playBackgroundMusic(e){sounds.background[e].loop=true;if(!muted){sounds.background[e].play()}return sounds.background[e]}function mute(){muted=true;if(currentBackground!=undefined){currentBackground.pause()}$("#mute").html("Unmute").addClass("muted").removeClass("mute")}function unmute(){muted=false;if(currentBackground!=undefined){currentBackground.play()}$("#mute").html("Mute").removeClass("muted").addClass("mute")}function toggleMute(){if(muted){unmute()}else{mute()}}function normalizeAngle(e){e%=2*Math.PI;if(e<0){e+=2*Math.PI}return e}function getGradient(e,t,n){ret=[];for(var r=0;r<n;r++){ret.push("rgb("+Math.round((e.r*(n-1-r)+t.r*r)/(n-1))+","+Math.round((e.g*(n-1-r)+t.g*r)/(n-1))+","+Math.round((e.b*(n-1-r)+t.b*r)/(n-1))+")")}return ret}function addEnemies(e,t){for(var n=0;n<e;n++){addEnemy(t)}}function addEnemy(e){var t=randomPosition(10);var n=new Enemy(t.x,t.y,Math.random()*2*Math.PI,levels[currentLevel].enemySpeedBase+levels[currentLevel].enemySpeedRandom*Math.random(),levels[currentLevel].enemyAgilityBase+levels[currentLevel].enemyAgilityRandom*Math.random());enemies.push(n);if(e){highlights.push(new Birth(n.x,n.y))}}function addPassersby(e){for(var t=0;t<e;t++){addPasserby()}}function addPasserby(){var e=randomPosition(10);var t=new Passerby(e.x,e.y,Math.random()*2*Math.PI,levels[currentLevel].passerbySpeedBase+levels[currentLevel].passerbySpeedRandom*Math.random(),levels[currentLevel].passerbyAgilityBase+levels[currentLevel].passerbyAgilityRandom*Math.random());passersby.push(t)}function randomPosition(e){var t=new Position(Math.random()*canvas.width,Math.random()*canvas.height);t.collisionRadius=e;for(var n=0;n<levels[currentLevel].walls.length;n++){if(levels[currentLevel].walls[n].collidesWith(t)){return randomPosition(e)}}return t}function refreshStats(){for(var e in stats){if($("#"+e).html()!=stats[e]){$("#"+e).hide().html(stats[e]).show("slide",{direction:"down"},200)}}if($("#enemies").html()!=enemies.length){$("#enemies").hide().html(enemies.length).show("slide",{direction:"down"},200)}if($("#level").html()!=currentLevel+1){$("#level").hide().html(currentLevel+1).show("slide",{direction:"down"},200);if(currentLevel==0){$("#level-description").html("st level")}else if(currentLevel==1){$("#level-description").html("nd level")}else if(currentLevel==2){$("#level-description").html("rd level")}else{$("#level-description").html("th level")}}$("#hits").html(stats.enemyHit+stats.wallHit+stats.passerbyHit)}function copyObject(e,t){for(var n in t){e[n]=t[n]}}function Wall(e,t,n,r){this.xMin=e;this.yMin=t;this.xMax=n;this.yMax=r;this.render=function(){context.beginPath();context.rect(this.xMin,this.yMin,this.xMax-this.xMin,this.yMax-this.yMin);context.closePath();context.fillStyle=colors.wall;context.fill()};this.collidesXWith=function(e){return this.xMin<e.x+e.collisionRadius&&e.x-e.collisionRadius<this.xMax};this.collidesYWith=function(e){return this.yMin<e.y+e.collisionRadius&&e.y-e.collisionRadius<this.yMax};this.collidesWith=function(e){return this.collidesXWith(e)&&this.collidesYWith(e)}}function Explosion(e,t){copyObject(this,new Highlight(e,t));this.render=function(){context.beginPath();context.arc(this.x,this.y,this.step+1,0,2*Math.PI,false);context.closePath();context.fillStyle=colors.explosion[this.step];context.fill()}}function Birth(e,t){copyObject(this,new Highlight(e,t));this.render=function(){context.beginPath();context.arc(this.x,this.y,this.step+1,0,2*Math.PI,false);context.closePath();context.fillStyle=colors.birth[this.step];context.fill()}}function Highlight(e,t){copyObject(this,new Position(e,t));this.step=colors.explosion.length-1;this.updatePosition=function(){this.step=Math.max(this.step-1,0)};this.render=function(){console.log("render not implemented")}}function Player(e,t,n,r,i){copyObject(this,new Thing(e,t,n,r,i));this.collisionRadius=5;this.render=function(){for(var e=0;e<this.xHistory.length;e++){context.beginPath();context.rect(this.xHistory[e]-(e+1)/2,this.yHistory[e]-(e+1)/2,e+1,e+1);context.closePath();context.fillStyle=colors.playerHistory[e];context.fill()}context.beginPath();context.rect(this.x-5,this.y-5,10,10);context.closePath();context.fillStyle=colors.player;context.fill()}}function Enemy(e,t,n,r,i){copyObject(this,new Thing(e,t,n,r,i));this.render=function(){for(var e=0;e<this.xHistory.length;e++){context.beginPath();context.rect(this.xHistory[e]-1,this.yHistory[e]-1,2,2);context.closePath();context.fillStyle=colors.enemyHistory[e];context.fill()}context.beginPath();context.rect(this.x-2,this.y-2,4,4);context.closePath();context.fillStyle=colors.enemy;context.fill()}}function Passerby(e,t,n,r,i){copyObject(this,new Thing(e,t,n,r,i));this.collisionRadius=5;this.render=function(){for(var e=0;e<this.xHistory.length;e++){context.beginPath();context.rect(this.xHistory[e]-5+(this.xHistory.length-e)/2,this.yHistory[e]-5+(this.xHistory.length-e)/2,10-(this.xHistory.length-e),10-(this.xHistory.length-e)/2);context.closePath();context.fillStyle=colors.passerbyHistory[e];context.fill()}context.beginPath();context.rect(this.x-5,this.y-5,10,10);context.closePath();context.fillStyle=colors.passerby;context.fill()}}function Thing(e,t,n,r,i){copyObject(this,new Position(e,t));this.xHistory=[];this.yHistory=[];this.angle=n;this.speed=r;this.agility=i;this.collisionRadius=3;this.updatePosition=function(){this.xHistory.push(this.x);if(this.xHistory.length>pointsHistory){this.xHistory.splice(0,this.xHistory.length-pointsHistory)}this.yHistory.push(this.y);if(this.yHistory.length>pointsHistory){this.yHistory.splice(0,this.yHistory.length-pointsHistory)}this.x+=this.speed*Math.sin(this.angle);this.y+=this.speed*Math.cos(this.angle)};this.turnLeft=function(){this.angle+=this.agility};this.turnRight=function(){this.angle-=this.agility};this.normalizeAngle=function(){this.angle=normalizeAngle(this.angle)};this.turnTowards=function(e){this.normalizeAngle();var t=Math.atan((e.x-this.x)/(e.y-this.y));if(e.y-this.y<0){t+=Math.PI}t=normalizeAngle(t);if(t<Math.PI){if(this.angle-t>0&&this.angle-t<Math.PI){this.turnRight()}else{this.turnLeft()}}else{if(t-this.angle>0&&t-this.angle<Math.PI){this.turnLeft()}else{this.turnRight()}}};this.render=function(){console.log("render not implemented")};this.collidesWith=function(e){return this.collisionRadius+e.collisionRadius>=Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}}function Position(e,t){this.x=e;this.y=t}var debug=false;var canvas;var context;var player;var enemies;var passersby;var highlights;var keysPressed;var currentFrame;var frameRateStart;var frameRate;var framesNoEnemy;var sounds={background:[new Audio("sound/background_1.mp3"),new Audio("sound/background_2.mp3"),new Audio("sound/background_3.mp3"),new Audio("sound/background_4.mp3")],enemy_kill:[new Audio("sound/enemy_kill_1.wav"),new Audio("sound/enemy_kill_2.wav"),new Audio("sound/enemy_kill_3.wav"),new Audio("sound/enemy_kill_4.wav"),new Audio("sound/enemy_kill_5.wav"),new Audio("sound/enemy_kill_6.wav"),new Audio("sound/enemy_kill_7.wav"),new Audio("sound/enemy_kill_8.wav")],player_hit:[new Audio("sound/player_hit_1.wav"),new Audio("sound/player_hit_2.wav"),new Audio("sound/player_hit_3.wav"),new Audio("sound/player_hit_4.wav")]};var soundIndex={enemy_kill:0,player_hit:0};var currentBackground;var muted=false;var currentCronjobs=[];var pointsHistory=10;var colors;var currentLevel=0;var levels;var won=false;var readyToStart=true;var stats={enemyHit:0,killsEnemy:0,killsPasserby:0,killsWall:0,passerbyHit:0,wallHit:0};$(function(){canvas=document.getElementById("main-canvas");canvas.height=$("#main-canvas").height();canvas.width=$("#main-canvas").width();context=canvas.getContext("2d");levels=[{backgroundIndex:0,enemyAgilityBase:.01,enemyAgilityRandom:.03,enemySpeedBase:3,enemySpeedRandom:1,initialEnemies:15,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:1,penaltyEnemy:1,penaltyPasserby:1,playerAgility:.1,playerSpeed:2,text:"You stole a potato from the local supermarket. Fortunately, the guards are not that agile and can't corner sharply (Who expects somebody to steal potatoes?). Make them run against a wall to escape and enjoy your tasteful potato!",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:1,enemyAgilityBase:.04,enemyAgilityRandom:.03,enemySpeedBase:3,enemySpeedRandom:1,initialEnemies:30,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:1,penaltyEnemy:1,penaltyPasserby:1,playerAgility:.1,playerSpeed:2,text:"You escaped, but now they are warned! Sadly, you stole only one potato and are therefore still hungry. Get some more potatoes this time, but be aware that the guards got better and brought some colleagues. Afterwards, you may finish lunch and take a trip down memory lane.",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:2,enemyAgilityBase:.04,enemyAgilityRandom:.03,enemySpeedBase:4,enemySpeedRandom:1,initialEnemies:50,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:1,penaltyEnemy:1,penaltyPasserby:1,playerAgility:.1,playerSpeed:2,text:"After lunch there is some time to think about the past. You have always been stealing. Long time ago you began shoplifting lollipops. The guards were faster, but there were also some buildings around. The corners saved you more than just once...",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height),new Wall(canvas.width/3,canvas.height/3,2*canvas.width/3,2*canvas.height/3)],winFrames:30},{backgroundIndex:3,enemyAgilityBase:.04,enemyAgilityRandom:.03,enemySpeedBase:4,enemySpeedRandom:1,initialEnemies:100,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:1,penaltyEnemy:1,penaltyPasserby:1,playerAgility:.1,playerSpeed:3,text:"You got better over time and began to look for more expensive things. Once you stole a laptop from some nerds. They were hard working as under time pressure. Don't know what the abbreviation on their screen meant...",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height),new Wall(125,175,145,275),new Wall(125,255,195,275),new Wall(215,175,235,275),new Wall(215,255,285,275),new Wall(265,175,285,275),new Wall(215,175,285,195),new Wall(315,215,335,275),new Wall(315,255,385,275),new Wall(365,175,385,235),new Wall(315,175,385,195),new Wall(315,215,385,235),new Wall(405,175,425,275),new Wall(405,255,475,275),new Wall(455,215,475,275),new Wall(405,175,475,195),new Wall(405,215,475,235)],winFrames:30},{backgroundIndex:0,enemyAgilityBase:.05,enemyAgilityRandom:.03,enemySpeedBase:5,enemySpeedRandom:1,initialEnemies:25,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:2,penaltyEnemy:3,penaltyPasserby:1,playerAgility:.1,playerSpeed:4,text:"When they saw you quite often, they knew that reinforcements were needed. Try not to be arrested. I mean, you should always do that, but this time, they will use your mistakes shamelessly.",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:1,enemyAgilityBase:.15,enemyAgilityRandom:.1,enemySpeedBase:5,enemySpeedRandom:1,initialEnemies:100,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:10,penaltyEnemy:1,penaltyPasserby:1,playerAgility:.1,playerSpeed:4,text:"One day you decided that it may be clever to steal where nobody knows you. It would have been even more clever to know the city before running through it. There are buildings everywhere. You have to stay alive when you killed all enemies for quite a long time to find your way out here. Hope the stolen gaming consoles are worth it.",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:100},{backgroundIndex:2,enemyAgilityBase:.07,enemyAgilityRandom:.05,enemySpeedBase:7,enemySpeedRandom:2,initialEnemies:100,initialPassersby:0,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:0,penaltyWall:3,penaltyEnemy:3,penaltyPasserby:1,playerAgility:.15,playerSpeed:5,text:"The workout on this stolen treadmill was hard, but now you are much faster. It seems like the policemen used the other one they confiscated, because they got faster, too. Will you get the new couch to your home? You can't always steal treadmills... what about a new TV next?",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:3,enemyAgilityBase:.05,enemyAgilityRandom:.03,enemySpeedBase:5,enemySpeedRandom:1,initialEnemies:25,initialPassersby:25,passerbyAgilityBase:.05,passerbyAgilityRandom:.03,passerbySpeedBase:0,passerbySpeedRandom:0,penaltyWall:2,penaltyEnemy:3,penaltyPasserby:50,playerAgility:.1,playerSpeed:4,text:"When shoplifting in pedestrian areas there are many passersby around. These are the yellow guys. You don't need to get rid of them, they are just in your way. In fact, I can't recommend hitting them. Cops get really angry when you do this. But you will notice this on your own... Good news is that they obstruct your enemies' way too.",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:0,enemyAgilityBase:.05,enemyAgilityRandom:.03,enemySpeedBase:4,enemySpeedRandom:1,initialEnemies:25,initialPassersby:25,passerbyAgilityBase:.05,passerbyAgilityRandom:.03,passerbySpeedBase:.5,passerbySpeedRandom:.5,penaltyWall:2,penaltyEnemy:3,penaltyPasserby:50,playerAgility:.1,playerSpeed:3,text:"Back to modern problems: These passersby are really annoying. All the time they are staring into their smartphones and don't look what is going on around them. They just move randomly around... Thankfully, this is no mobile game as I don't want to insult you.",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:30},{backgroundIndex:1,enemyAgilityBase:.05,enemyAgilityRandom:.03,enemySpeedBase:4,enemySpeedRandom:1,initialEnemies:75,initialPassersby:25,passerbyAgilityBase:.15,passerbyAgilityRandom:.03,passerbySpeedBase:1,passerbySpeedRandom:.5,penaltyWall:5,penaltyEnemy:5,penaltyPasserby:50,playerAgility:.1,playerSpeed:3,text:"Who is the architect of this building? Did he think of poor shoplifters trying to escape the police when designing this mall?",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height)],winFrames:70},{backgroundIndex:3,enemyAgilityBase:.1,enemyAgilityRandom:.1,enemySpeedBase:8,enemySpeedRandom:2,initialEnemies:200,initialPassersby:15,passerbyAgilityBase:.15,passerbyAgilityRandom:.03,passerbySpeedBase:1,passerbySpeedRandom:.5,penaltyWall:5,penaltyEnemy:5,penaltyPasserby:50,playerAgility:.1,playerSpeed:6,text:"This seems to be easier. There are lots of security guys which is normal for an airport. Wait... what should you steal at an airport? An airplane? You can't hide this under your coat...",walls:[new Wall(0,0,15,canvas.height),new Wall(canvas.width-15,0,canvas.width,canvas.height),new Wall(0,0,canvas.width,15),new Wall(0,canvas.height-15,canvas.width,canvas.height),new Wall(canvas.width/3,canvas.height/3,canvas.width/3+15,canvas.height*2/3),new Wall(canvas.width*2/3,canvas.height/3,canvas.width*2/3+15,canvas.height*2/3)],winFrames:30},{backgroundIndex:3,enemyAgilityBase:.1,enemyAgilityRandom:.06,enemySpeedBase:10,enemySpeedRandom:3,initialEnemies:50,initialPassersby:20,passerbyAgilityBase:.1,passerbyAgilityRandom:0,passerbySpeedBase:1,passerbySpeedRandom:1,penaltyWall:15,penaltyEnemy:15,penaltyPasserby:50,playerAgility:.2,playerSpeed:8,text:"WTF is happening here? Can you master this last level?",walls:[new Wall(0,0,15,450),new Wall(585,0,600,450),new Wall(0,0,600,15),new Wall(0,435,600,450)],winFrames:30}];for(var e=30;e<450;e+=50){levels[5].walls.push(new Wall(canvas.width/2-7.5,e,canvas.width/2+7.5,e+15));levels[5].walls.push(new Wall(e,e,e+15,e+15));levels[5].walls.push(new Wall(canvas.width-e-15,e,canvas.width-e,e+15));levels[5].walls.push(new Wall(e,canvas.height-e-15,e+15,canvas.height-e));levels[5].walls.push(new Wall(canvas.width-e-15,canvas.height-e-15,canvas.width-e,canvas.height-e))}var t=50;var n=50;for(var r=1;r<50;r++){t=(5*r+123*t)%(canvas.width-45)+15;n=(7*r+177*n)%(canvas.height-45)+15;levels[9].walls.push(new Wall(t,n,t+15,n+15))}colors={player:"rgb(200, 255, 200)",playerHistory:getGradient({r:0,g:0,b:0},{r:100,g:200,b:100},10),enemy:"rgb(50, 150, 255)",enemyHistory:getGradient({r:0,g:0,b:0},{r:0,g:0,b:0},5).concat(getGradient({r:0,g:0,b:0},{r:45,g:135,b:230},5)),passerby:"rgb(255, 255, 0)",passerbyHistory:getGradient({r:0,g:0,b:0},{r:200,g:200,b:0},10),debug:"rgb(255, 255, 255)",explosion:getGradient({r:255,g:0,b:0},{r:255,g:255,b:0},10),birth:getGradient({r:0,g:0,b:255},{r:0,g:200,b:255},10),wall:"rgb(255, 255, 255)",headings:"rgb(255, 255, 255)",background:"rgb(0, 0, 0)"};$(document).keydown(function(e){if(e.keyCode==32){startGame()}if(e.keyCode==80){stopGame()}if(e.keyCode==77){toggleMute()}if(-1==$.inArray(e.keyCode,keysPressed)){keysPressed.push(e.keyCode)}return false});$(document).keyup(function(e){keysPressed=$.grep(keysPressed,function(t){return t!=e.keyCode});return false});$("#main-canvas").click(function(){startGame()});loadLevel()})